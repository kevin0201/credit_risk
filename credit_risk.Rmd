---
title: "credit_risk"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

# Hypothèse
On suppose un portefeuille de 20 obligataires : 1...20
Ces débiteurs sont classés par ordre croissants de sensibilité. 1:est le plus sensible et d:est le moins sensible.


# Construction des lamda systématiques

on construit un vecteur de lamda systématiques qui représenteront l'entensité du processus de poisson de chaque débiteur. Plus l'intensité est grande, plus le débiteur est sensible. On construit donc un vecteur d'intensité, décroissant. En effet plus un débiteur est insensible au risque de défaut systématique plus son évènement de défaut est rare.

```{r}

# Librairie poisson permet la simulation et la visualisation de processus de poisson
library(poisson)
library(ggplot2)
library(reshape2)

d = 20

# En supposant que la différence de sensibilité suit une loi normale... mais ceci dépend de la loi des lamada...
lamda = sort(runif(d,min = 0.06, max = 0.1), decreasing = TRUE)

#names(lamda_sys) = strsplit(toString(seq(1,20)), split = ", ")

names_ob = c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20")

names(lamda) = names_ob

# l'intensité systématique pour chaque emmetteur

lamda_sys = cumsum(sort(lamda, decreasing = FALSE))

plot( sort(lamda_sys,decreasing = TRUE     ))

```


```{r}
hpp_sys = as.data.frame( matrix(0, nrow = d+1, ncol = length(lamda_sys)))

for (i in 1:length(lamda_sys)){
  
  hpp_sys[,i] = hpp.sim(lamda_sys[i], num.events = d)
  
}

hpp_sys["Events"] = seq(0,d)



ggplot(melt(hpp_sys,id.vars = "Events"),aes(x=value,y=Events, group=variable, color=variable))+geom_line()

```



```{r}
# On considere que le facteur idio est plus courant alors pour chaque débiteur selon la remarque, l'intensité sera moins grande 

lamda_idio = runif(d,min = 0.06, max = 0.1)

plot(lamda_idio)

```

```{r}
# Construction des toi de chaque débiteur...

toi = lamda_sys+lamda_idio

toi = sort(toi, decreasing = TRUE)

plot(toi)

```

```{r}
# Probat de survie sur T = 

T = seq(1,5)

survie = exp(-toi*2)

plot(toi,1-survie)

# surviemat = as.data.frame(matrix(0,nrow = length(T),ncol = length(toi)))
# 
# for (i in 1:length(toi)){
#   
#   surviemat[,i] = exp(-toi[i]*T)
#   
# }

surviemat["Maturite"] = T

ggplot(melt(surviemat,id.vars = "Maturite"),aes(x=Maturite,y=value, group=variable, color=variable))+geom_line()

1-survie
```


```{r}
# system
 T =10
probasys = c()

lamda_sys = sort(lamda_sys, decreasing = TRUE)
for (i in 1:19){
probasys[i] = exp(-T*lamda_sys[i+1])-exp(-T*lamda_sys[i])
}

m=0:100

probaidio = (1/factorial(m))*((T*sum(lamda_idio[2:d]))^m)*exp(-T*sum(lamda_idio[2:d]))

plot(probaidio)

plot(sort(probasys,decreasing = TRUE))


```

